!function(e){if(void 0===e)throw Error("Leaflet must be included first");e.Control.Layers.Tree=e.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"&minus;",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:"",labelIsSelector:"both"},_initClassesNames:function(){this.cls={children:"leaflet-layerstree-children",childrenNopad:"leaflet-layerstree-children-nopad",hide:"leaflet-layerstree-hide",closed:"leaflet-layerstree-closed",opened:"leaflet-layerstree-opened",space:"leaflet-layerstree-header-space",pointer:"leaflet-layerstree-header-pointer",header:"leaflet-layerstree-header",neverShow:"leaflet-layerstree-nevershow",node:"leaflet-layerstree-node",name:"leaflet-layerstree-header-name",label:"leaflet-layerstree-header-label",selAllCheckbox:"leaflet-layerstree-sel-all-checkbox"}},initialize:function(t,l,s){this._scrollTop=0,this._initClassesNames(),this._baseTree=null,this._overlaysTree=null,e.Util.setOptions(this,s),e.Control.Layers.prototype.initialize.call(this,null,null,s),this._setTrees(t,l)},setBaseTree:function(e){return this._setTrees(e)},setOverlayTree:function(e){return this._setTrees(void 0,e)},addBaseLayer:function(e,t){throw"addBaseLayer is disabled"},addOverlay:function(e,t){throw"addOverlay is disabled"},removeLayer:function(e){throw"removeLayer is disabled"},collapse:function(){return this._scrollTop=this._sect().scrollTop,e.Control.Layers.prototype.collapse.call(this)},expand:function(){e.Control.Layers.prototype.expand.call(this),this._sect().scrollTop=this._scrollTop},onAdd:function(t){function l(e){e._layersTreeName&&(a.innerHTML=e._layersTreeName)}var s=e.Control.Layers.prototype.onAdd.call(this,t);if(this.options.namedToggle){var a=this._container.getElementsByClassName("leaflet-control-layers-toggle")[0];e.DomUtil.addClass(a,"leaflet-layerstree-named-toggle"),t.eachLayer(function(e){l(e)}),t.on("baselayerchange",function(e){l(e.layer)},this)}return s},expandTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!1),this._localExpand()},collapseTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!0),this._localExpand()},expandSelected:function(t){function l(t){var a=t.parentElement;if(a){if(e.DomUtil.hasClass(a,s.cls.children)&&!e.DomUtil.hasClass(t,s.cls.childrenNopad)&&e.DomUtil.removeClass(a,i),e.DomUtil.hasClass(a,s.cls.node)){var r=a.getElementsByClassName(s.cls.header)[0];s._applyOnTree(r,!1)}l(a)}}var s=this,a=t?this._overlaysList:this._baseLayersList;if(!a)return this;for(var i=this.cls.hide,r=this._layerControlInputs||a.getElementsByTagName("input"),n=0;n<r.length;n++){var o=r[n];(!this._getLayer||!!this._getLayer(o.layerId).overlay==!!t)&&o.checked&&l(o.parentElement.parentElement.parentElement.parentElement)}return this._localExpand()},_sect:function(){return this._section||this._form},_setTrees:function(e,t){var l=0;function s(e,t,a){return e&&e.layer&&(a||(e.layer._layersTreeName=e.name||e.label),t[l++]=e.layer),e&&e.children&&e.children.length&&e.children.forEach(function(e){s(e,t,a)}),t}function a(e){return Array.isArray(e)?{noShow:!0,children:e}:e}this._layerControlInputs&&(this._layerControlInputs=[]);for(var i=0;i<this._layers.length;++i)this._layers[i].layer.off("add remove",this._onLayerChange,this);this._layers=[],void 0!==e&&(this._baseTree=a(e)),void 0!==t&&(this._overlaysTree=a(t));var r=s(this._baseTree,{});for(var n in r)this._addLayer(r[n],n);var o=s(this._overlaysTree,{},!0);for(var c in o)this._addLayer(o[c],c,!0);return this._map?this._update():this},_localExpand:function(){if(this._map&&e.DomUtil.hasClass(this._container,"leaflet-control-layers-expanded")){var t=this._sect().scrollTop;this.expand(),this._sect().scrollTop=t,this._scrollTop=t}return this},_applyOnTree:function(t,l){[{cls:this.cls.children,hide:l},{cls:this.cls.opened,hide:l},{cls:this.cls.closed,hide:!l},].forEach(function(l){for(var s=t.getElementsByClassName(l.cls),a=0;a<s.length;a++){var i=s[a];e.DomUtil.hasClass(i,this.cls.childrenNopad)||(l.hide?e.DomUtil.addClass(i,this.cls.hide):e.DomUtil.removeClass(i,this.cls.hide))}},this)},_addItem:function(e){},_update:function(){return this._container?(e.Control.Layers.prototype._update.call(this),this._addTreeLayout(this._baseTree,!1),this._addTreeLayout(this._overlaysTree,!0),this._localExpand()):this},_addTreeLayout:function(e,t){if(e){var l=t?this._overlaysList:this._baseLayersList;this._expandCollapseAll(t,this.options.collapseAll,this.collapseTree),this._expandCollapseAll(t,this.options.expandAll,this.expandTree),this._iterateTreeLayout(e,l,t,[],e.noShow),this._checkDisabledLayers&&this._checkDisabledLayers()}},_expandCollapseAll:function(t,l,s,a){var i=t?this._overlaysList:this._baseLayersList;if(a=a||this,l){var r=document.createElement("div");r.className="leaflet-layerstree-expand-collapse",i.appendChild(r),r.innerHTML=l,r.tabIndex=0,e.DomEvent.on(r,"click keydown",function(e){("keydown"!==e.type||32===e.keyCode)&&(r.blur(),s.call(a,t),this._localExpand())},this)}},_iterateTreeLayout:function(t,l,s,a,i){if(t){var r,n=$("div",this.cls.header,l),o=$("span"),c=$("span"),h=$("span",this.cls.closed,o,this.options.closedSymbol),d=$("span",this.cls.opened,o,this.options.openedSymbol),p=$("span",this.cls.space,null,this.options.spaceSymbol);this.options.selectorBack?(o.insertBefore(p,h),n.appendChild(c),n.appendChild(o)):(o.appendChild(p),n.appendChild(o),n.appendChild(c)),t.selectAllCheckbox&&(v=this._createCheckboxElement(!1),v.className+=" "+this.cls.selAllCheckbox);var y=this.cls.hide;if(t.children){var u=$("div",this.cls.children,l),f=t.layer?o:n;e.DomUtil.addClass(f,this.cls.pointer),f.tabIndex=0,e.DomEvent.on(f,"click keydown",function(t){!this._preventClick&&("keydown"!==t.type||32===t.keyCode)&&(f.blur(),e.DomUtil.hasClass(d,y)?(e.DomUtil.addClass(h,y),e.DomUtil.removeClass(d,y),e.DomUtil.removeClass(u,y)):(e.DomUtil.removeClass(h,y),e.DomUtil.addClass(d,y),e.DomUtil.addClass(u,y)),this._localExpand())},this),v&&a.splice(0,0,l),t.children.forEach(function(e){var t=$("div",this.cls.node,u);this._iterateTreeLayout(e,t,s,a)},this),v&&a.splice(0,1)}else e.DomUtil.addClass(o,this.cls.neverShow);var m=$(C=t.layer&&("both"===this.options.labelIsSelector||s&&"overlay"===this.options.labelIsSelector||!s&&"base"===this.options.labelIsSelector)?"label":"span",this.cls.label,c);if(t.layer){var v,C,b,T=this._map.hasLayer(t.layer),k=s?t.radioGroup:"leaflet-base-layers_"+e.Util.stamp(this);k?b=this._createRadioElement(k,T):S(b=this._createCheckboxElement(T),this),this._layerControlInputs&&this._layerControlInputs.push(b),b.layerId=e.Util.stamp(t.layer),e.DomEvent.on(b,"click",this._onInputClick,this),m.appendChild(b)}t.selectAllCheckbox&&(m.appendChild(v),r=t.selectAllCheckbox,("string"==typeof r||r instanceof String)&&(v.title=t.selectAllCheckbox),e.DomEvent.on(v,"click",function(e){e.stopPropagation(),A(v.checked,this)},this),U(l),S(v,this)),$("span",this.cls.name,m,t.label),e.DomUtil.addClass(t.collapsed?d:h,y),t.collapsed&&u&&e.DomUtil.addClass(u,y),i&&(e.DomUtil.addClass(n,this.cls.neverShow),e.DomUtil.addClass(u,this.cls.childrenNopad));var x=t.eventedClasses;x instanceof Array||(x=[x]);for(var E=0;E<x.length;E++){var D=x[E];if(D&&D.className){var g=l.querySelector("."+D.className);g&&e.DomEvent.on(g,D.event||"click",function(e){return function(s){s.stopPropagation();var a=N(e)?e(s,l,t,this._map):e;null!=a&&A(a,this)}}(D.selectAll),this)}}}function $(t,l,s,a){var i=e.DomUtil.create(t,l,s);return a&&(i.innerHTML=a),i}function U(e){var t=e.querySelector("input[type=checkbox]"),l=!0,s=!0,a=e.querySelectorAll("input[type=checkbox]");[].forEach.call(a,function(e){e!==t&&(e.indeterminate?(l=!1,s=!1):e.checked?s=!1:e.checked||(l=!1))}),l?(t.indeterminate=!1,t.checked=!0):s?(t.indeterminate=!1,t.checked=!1):(t.indeterminate=!0,t.checked=!1)}function S(t,l){a.forEach(function(s){e.DomEvent.on(t,"click",function(e){U(s)},l)},l)}function N(e){return e&&"[object Function]"===({}).toString.call(e)}function A(e,t){for(var s=l.getElementsByTagName("input"),a=0;a<s.length;a++){var i=s[a];"checkbox"===i.type&&(i.checked=e,i.indeterminate=!1)}t._onInputClick()}},_createCheckboxElement:function(e){var t=document.createElement("input");return t.type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=e,t}}),e.control.layers.tree=function(t,l,s){return new e.Control.Layers.Tree(t,l,s)}}(L);