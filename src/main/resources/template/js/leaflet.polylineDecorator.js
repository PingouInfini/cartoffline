!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],i):i(t.L)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var i,n,o,e=function t(i,n){var o=i.value;return i.isInPixels?o/n:o};function s(t){if("string"==typeof t&&-1!==t.indexOf("%"))return{value:parseFloat(t)/100,isInPixels:!1};var i=t?parseFloat(t):0;return{value:i,isInPixels:i>0}}i=L.Marker.prototype._initIcon,n=L.Marker.prototype._setPos,o="msTransform"===L.DomUtil.TRANSFORM,L.Marker.addInitHook(function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(t){t.target._applyRotation()})}),L.Marker.include({_initIcon:function(){i.call(this)},_setPos:function(t){n.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,o?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}}),t.Symbol=t.Symbol||{},t.Symbol.Dash=t.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function i(n){t.Util.setOptions(this,n),this.options.pathOptions.clickable=!1},buildSymbol:function i(n,o,e,s,r){var a=this.options;if(a.pixelSize<=1)return t.polyline([n.latLng,n.latLng],a.pathOptions);var p=e.project(n.latLng),h=-(n.heading-90)*(Math.PI/180),l=t.point(p.x+a.pixelSize*Math.cos(h+Math.PI)/2,p.y+a.pixelSize*Math.sin(h)/2),u=p.add(p.subtract(l));return t.polyline([e.unproject(l),e.unproject(u)],a.pathOptions)}}),t.Symbol.dash=function(i){return new t.Symbol.Dash(i)},t.Symbol.ArrowHead=t.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function i(n){t.Util.setOptions(this,n),this.options.pathOptions.clickable=!1},buildSymbol:function i(n,o,e,s,r){return this.options.polygon?t.polygon(this._buildArrowPath(n,e),this.options.pathOptions):t.polyline(this._buildArrowPath(n,e),this.options.pathOptions)},_buildArrowPath:function i(n,o){var e=Math.PI/180,s=o.project(n.latLng),r=-(n.heading-90)*e,a=this.options.headAngle/2*e,p=r+a,h=r-a,l=t.point(s.x-this.options.pixelSize*Math.cos(p),s.y+this.options.pixelSize*Math.sin(p)),u=t.point(s.x-this.options.pixelSize*Math.cos(h),s.y+this.options.pixelSize*Math.sin(h));return[o.unproject(l),n.latLng,o.unproject(u)]}}),t.Symbol.arrowHead=function(i){return new t.Symbol.ArrowHead(i)},t.Symbol.Marker=t.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function i(n){t.Util.setOptions(this,n),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function i(n,o,e,s,r){return this.options.rotate&&(this.options.markerOptions.rotationAngle=n.heading+(this.options.angleCorrection||0)),t.marker(n.latLng,this.options.markerOptions)}}),t.Symbol.marker=function(i){return new t.Symbol.Marker(i)};var r=function i(n){var o;return Array.isArray(n)&&((o=n[0])instanceof t.LatLng||Array.isArray(o)&&2===o.length&&"number"==typeof o[0])};t.PolylineDecorator=t.FeatureGroup.extend({options:{patterns:[]},initialize:function i(n,o){t.FeatureGroup.prototype.initialize.call(this),t.Util.setOptions(this,o),this._map=null,this._paths=this._initPaths(n),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function i(n,o){var e=this;return r(n)?[o?n.concat([n[0]]):n]:n instanceof t.Polyline?this._initPaths(n.getLatLngs(),n instanceof t.Polygon):Array.isArray(n)?n.reduce(function(t,i){return t.concat(e._initPaths(i,o))},[]):[]},_initPatterns:function t(i){return i.map(this._parsePatternDef)},setPatterns:function t(i){this.options.patterns=i,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function t(i){this._paths=this._initPaths(i),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function t(i,n){return{symbolFactory:i.symbol,offset:s(i.offset),endOffset:s(i.endOffset),repeat:s(i.repeat)}},onAdd:function t(i){this._map=i,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function i(n){this._map.off("moveend",this.redraw,this),this._map=null,t.FeatureGroup.prototype.onRemove.call(this,n)},_initBounds:function i(){var n=this._paths.reduce(function(t,i){return t.concat(i)},[]);return t.latLngBounds(n)},getBounds:function t(){return this._bounds},_buildSymbols:function t(i,n,o){var e=this;return o.map(function(t,s){return n.buildSymbol(t,i,e._map,s,o.length)})},_getDirectionPoints:function i(n,o){var s=this;return n.length<2?[]:(function t(i,n){var o,s=(o=i).reduce(function(t,i,n,o){var e,s;if(n>0&&(e=i,s=o[n-1],e.x!==s.x||e.y!==s.y)){var r,a,p,h,l,u,c=o[n-1],f=t.length>0?t[t.length-1].distB:0,d=(r=c,p=(a=i).x-r.x,Math.sqrt(p*p+(h=a.y-r.y)*h));t.push({a:c,b:i,distA:f,distB:f+d,heading:(l=c,(180*Math.atan2((u=i).y-l.y,u.x-l.x)/Math.PI+90+360)%360)})}return t},[]),r=s.length;if(0===r)return[];var a=s[r-1].distB,p=e(n.offset,a),h=e(n.endOffset,a),l=e(n.repeat,a),u=a*l,c=h>0?a*h:0,f=[],d=p>0?a*p:0;do f.push(d),d+=u;while(u>0&&d<a-c);var y=0,g=s[0];return f.map(function(t){for(;t>g.distB&&y<r-1;)g=s[++y];var i,n,o,e=(t-g.distA)/(g.distB-g.distA);return{pt:(i=g.a,n=g.b,o=e,n.x!==i.x?{x:i.x+o*(n.x-i.x),y:i.y+o*(n.y-i.y)}:{x:i.x,y:i.y+(n.y-i.y)*o}),heading:g.heading}})})(n.map(function(t){return s._map.project(t)}),o).map(function(i){return{latLng:s._map.unproject(t.point(i.pt)),heading:i.heading}})},redraw:function t(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function i(n){var o=this,e=this._map.getBounds().pad(.1);return this._paths.map(function(i){var s=o._getDirectionPoints(i,n).filter(function(t){return e.contains(t.latLng)});return t.featureGroup(o._buildSymbols(i,n.symbolFactory,s))})},_draw:function i(){var n=this;this._patterns.map(function(t){return n._getPatternLayers(t)}).forEach(function(i){n.addLayer(t.featureGroup(i))})}}),t.polylineDecorator=function(i,n){return new t.PolylineDecorator(i,n)}});